# –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Labels –Ω–µ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—é—Ç—Å—è –≤ conversation
- [x] –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `selected_software` –≤ —Å—Ö–µ–º—É `ConsultationCreate`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_build_chatwoot_labels()` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ü–û
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ `selected_software` –≤ —Ñ—É–Ω–∫—Ü–∏—é labels
- [x] Labels –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ conversation –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
- [x] –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_clean_company_name()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –º–∞—Å–∫–∏
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ 4 –º–µ—Å—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `company_name` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `create_or_update_client()`
- [x] –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Å–∫–∏ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ–∂–∏–¥–∞–Ω–∏–∏
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `SEND_QUEUE_WAIT_TIME_MESSAGE` –≤ config
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `create_consultation()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–ª–∞–≥–∞
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `send_queue_update_notification()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–ª–∞–≥–∞
- [x] –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–æ (backwards compatible)

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –î–ª—è labels (–ø—Ä–æ–±–ª–µ–º–∞ 1):
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ç—Ä–µ–±—É–µ–º—ã–µ labels —Å–æ–∑–¥–∞–Ω—ã –≤ Chatwoot:
   - "—Ä—É—Å" (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)
   - "—É–∑–±" (—É–∑–±–µ–∫—Å–∫–∏–π —è–∑—ã–∫)
   - "—Å–∞–π—Ç" (–∏—Å—Ç–æ—á–Ω–∏–∫ - —Å–∞–π—Ç)
   - "—Ç–≥" (–∏—Å—Ç–æ—á–Ω–∏–∫ - telegram)
   - "—Ç–µ—Ö" (—Ç–∏–ø - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞)
   - **"–±—É—Ö", "—Ä—Ç", "—É–∫"** (–≤—ã–±—Ä–∞–Ω–Ω–æ–µ –ü–û) - **–Ω–æ–≤—ã–µ labels, –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å**

2. –ï—Å–ª–∏ labels –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç, —Ñ—É–Ω–∫—Ü–∏—è `ensure_label_exists()` –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∏—Ö —Å–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

3. –§—Ä–æ–Ω—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π: "–±—É—Ö", "—Ä—Ç" –∏–ª–∏ "—É–∫" (–≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ)

### –î–ª—è company_name (–ø—Ä–æ–±–ª–µ–º–∞ 2):
1. –§—É–Ω–∫—Ü–∏—è `_clean_company_name()` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –º–∞—Å–∫–æ–π: "Clobus <–Ω–∞–∑–≤–∞–Ω–∏–µ> <–∫–æ–¥> (–ò–ù–ù)"

2. –õ–æ–≥–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏:
   - –£–±–∏—Ä–∞–µ—Ç "Clobus" –∏–∑ –Ω–∞—á–∞–ª–∞ (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
   - –£–±–∏—Ä–∞–µ—Ç –ò–ù–ù –≤ —Å–∫–æ–±–∫–∞—Ö –∏–∑ –∫–æ–Ω—Ü–∞ `(...)`
   - –£–±–∏—Ä–∞–µ—Ç —á–∏—Å–ª–æ–≤–æ–π –∫–æ–¥ –∏–∑ –∫–æ–Ω—Ü–∞

3. –ï—Å–ª–∏ –≤ company_name –Ω–µ—Ç –º–∞—Å–∫–∏, —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω—ë—Ç –µ–≥–æ –∫–∞–∫ –µ—Å—Ç—å (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

4. –ü—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ä—ã—Ö clients —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—á–∏—Å—Ç–∏—Ç—å company_name —Ä—É–∫–∞–º–∏ –≤ –ë–î

### –î–ª—è wait time message (–ø—Ä–æ–±–ª–µ–º–∞ 3):
1. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `SEND_QUEUE_WAIT_TIME_MESSAGE` –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `True` (–≤–∫–ª—é—á–µ–Ω–æ)

2. –ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ `.env`:
   ```
   SEND_QUEUE_WAIT_TIME_MESSAGE=true    # –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   SEND_QUEUE_WAIT_TIME_MESSAGE=false   # –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è
   ```

3. –°–æ–æ–±—â–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö:
   - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ (`create_consultation()`)
   - –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—á–µ—Ä–µ–¥–∏ (`send_queue_update_notification()`)

---

## üß™ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –∑–∞–ø—É—Å–∫–∞/–∏–º–ø–æ—Ä—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã 1**:
   - –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å `selected_software: "—Ä—Ç"`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Chatwoot, —á—Ç–æ conversation –∏–º–µ–µ—Ç label "—Ä—Ç"
   - –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–ª—è "–±—É—Ö" –∏ "—É–∫"

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã 2**:
   - –°–æ–∑–¥–∞—Ç—å client —Å company_name = "OOO TEST"
   - –û–±–Ω–æ–≤–∏—Ç—å client —Å company_name = "Clobus OOO TEST 12345 (9999999999)" (–ø–æ–ª–Ω–∞—è –º–∞—Å–∫–∞)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î, —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Ç–æ–ª—å–∫–æ "OOO TEST"
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å 1C –∏ —É–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏ –ª–æ–≥–æ–≤, —á—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Ç

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã 3**:
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `SEND_QUEUE_WAIT_TIME_MESSAGE=true`
   - –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Chatwoot (–¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è)
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `SEND_QUEUE_WAIT_TIME_MESSAGE=false`
   - –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Chatwoot (–¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏)

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

–ï—Å–ª–∏ –≤ –ë–î –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–µ client'—ã —Å company_name —Å–æ–¥–µ—Ä–∂–∞—â–∏–º–∏ –º–∞—Å–∫—É:

```sql
-- –ü—Ä–∏–º–µ—Ä–Ω—ã–π SQL –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ (–¢–†–ï–ë–£–ï–¢ –ü–†–û–í–ï–†–ö–ò –ò –ê–î–ê–ü–¢–ê–¶–ò–ò)
UPDATE cons.clients 
SET company_name = TRIM(
    REGEXP_REPLACE(
        REGEXP_REPLACE(
            REGEXP_REPLACE(company_name, '^[Cc][Ll][Oo][Bb][Uu][Ss]\s+', ''),
            '\s*\(\d+\)\s*$', ''
        ),
        '\s+\d+\s*$', ''
    )
)
WHERE company_name ILIKE 'Clobus%' AND company_name LIKE '%(%)';
```

**–í–ù–ò–ú–ê–ù–ò–ï**: –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ª—é–±–æ–≥–æ UPDATE –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ù–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑–µ
2. –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–º –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–µ

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- –ò—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –æ–ø–∏—Å–∞–Ω—ã –≤ PR/Issue –æ–ø–∏—Å–∞–Ω–∏–∏
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ `CHANGES_SUMMARY.md`
